{% extends 'base.html' %}
{% block title %}图书管理{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-3 col-sm-4">
    <h4>新增图书</h4>
    <form method="post" action="{{ url_for('books.create_book') }}">
      <div class="form-group">
        <label>名称</label>
        <input type="text" name="name" class="form-control" required>
      </div>
      <div class="form-group">
        <label>ISBN</label>
        <input type="text" name="isbn" class="form-control" required>
      </div>
      <div class="form-group">
        <label>分类</label>
        <select name="category_id" class="form-control">
          <option value="">未分类</option>
          {% for category in categories %}
          <option value="{{ category.id }}">{{ category.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>总数量</label>
        <input type="number" name="amount" class="form-control" value="1" min="1">
      </div>
      <div class="form-group">
        <label>位置</label>
        <input type="text" name="position" class="form-control">
      </div>
      <div class="form-group">
        <label>作者</label>
        <input type="text" name="author" class="form-control">
      </div>
      <div class="form-group">
        <label>出版社</label>
        <input type="text" name="publisher" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary btn-block">保存</button>
    </form>
    <hr>
    <h4>批量导入</h4>
    <form method="post" action="{{ url_for('books.import_books') }}" enctype="multipart/form-data">
      <div class="form-group">
        <input type="file" name="file" class="form-control">
      </div>
      <button type="submit" class="btn btn-info btn-block">导入Excel</button>
    </form>
    <a class="btn btn-success btn-block" href="{{ url_for('books.export_books') }}">导出Excel</a>
  </div>
  <div class="col-md-9 col-sm-8">
    <div class="panel panel-default">
      <div class="panel-heading">
        <form class="form-inline" method="get">
          <div class="form-group">
            <input type="text" name="q" class="form-control input-sm" placeholder="搜索书名或ISBN" value="{{ keyword }}">
          </div>
          <button class="btn btn-sm btn-primary" type="submit">搜索</button>
        </form>
      </div>
      <table class="table table-striped table-condensed table-hover">
        <thead>
          <tr>
            <th>名称</th>
            <th>ISBN</th>
            <th>分类</th>
            <th>库存</th>
            <th>已借出</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {% for book in books %}
          <tr>
            <td>{{ book.name }}</td>
            <td>{{ book.isbn }}</td>
            <td>{{ book.category.name if book.category else '未分类' }}</td>
            <td>{{ book.amount }}</td>
            <td>{{ book.lend_amount }}</td>
            <td>
              <button class="btn btn-xs btn-default" data-toggle="collapse" data-target="#edit-{{ book.id }}">编辑</button>
              <form method="post" action="{{ url_for('books.delete_book', book_id=book.id) }}" style="display:inline" onsubmit="return confirm('确认删除?');">
                <button class="btn btn-xs btn-danger" type="submit">删除</button>
              </form>
            </td>
          </tr>
          <tr id="edit-{{ book.id }}" class="collapse">
            <td colspan="6">
              <form method="post" action="{{ url_for('books.update_book', book_id=book.id) }}" class="form-inline">
                <input type="text" name="name" value="{{ book.name }}" class="form-control input-sm" placeholder="名称">
                <input type="text" name="isbn" value="{{ book.isbn }}" class="form-control input-sm" placeholder="ISBN">
                <input type="number" name="amount" value="{{ book.amount }}" class="form-control input-sm" style="width:100px" min="0">
                <input type="number" name="lend_amount" value="{{ book.lend_amount }}" class="form-control input-sm" style="width:100px" min="0">
                <input type="text" name="position" value="{{ book.position }}" class="form-control input-sm" placeholder="位置">
                <button type="submit" class="btn btn-sm btn-primary">保存</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
