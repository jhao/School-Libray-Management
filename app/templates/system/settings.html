{% extends 'base.html' %}
{% block title %}系统外观设置{% endblock %}
{% block content %}
<div class="page-header">
  <h2>系统外观设置</h2>
</div>
<form method="post" action="{{ url_for('system.system_settings') }}" enctype="multipart/form-data" class="form-horizontal">
  <div class="form-group">
    <label class="col-sm-2 control-label">系统Logo</label>
    <div class="col-sm-6">
      {% if logo_path %}
      <div class="current-logo">
        <img src="{{ url_for('static', filename=logo_path) }}" alt="当前Logo" class="img-thumbnail" style="max-height: 80px;">
      </div>
      {% endif %}
      <input type="file" name="logo" class="form-control">
      {% if logo_path %}
      <div class="checkbox" style="margin-top:8px;">
        <label><input type="checkbox" name="remove_logo" value="1"> 移除当前Logo</label>
      </div>
      {% endif %}
      <p class="help-block">建议上传透明背景的 PNG 图片。</p>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Topbar颜色</label>
    <div class="col-sm-3">
      <input type="color" name="topbar_color" id="topbar-color-input" class="form-control" value="{{ topbar_color }}">
    </div>
    <div class="col-sm-3">
      <button type="button" class="btn btn-default" id="reset-topbar-color">恢复默认颜色</button>
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-6">
      <button type="submit" class="btn btn-primary">保存设置</button>
    </div>
  </div>
</form>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  (function() {
    var colorInput = document.getElementById('topbar-color-input');
    var resetButton = document.getElementById('reset-topbar-color');
    var defaultColor = {{ default_topbar_color | tojson }};

    function applyColor(color) {
      var topbar = document.querySelector('.app-topbar');
      if (topbar) {
        topbar.style.backgroundColor = color;
      }
      var sidebar = document.getElementById('app-sidebar');
      if (sidebar) {
        sidebar.style.backgroundColor = color;
      }
    }

    if (colorInput) {
      colorInput.addEventListener('input', function() {
        applyColor(colorInput.value);
      });
    }

    if (resetButton && colorInput) {
      resetButton.addEventListener('click', function() {
        colorInput.value = defaultColor;
        applyColor(defaultColor);
      });
    }
  })();
</script>
{% endblock %}
